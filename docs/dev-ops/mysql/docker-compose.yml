name: dream
networks:
  app-network:  # 创建自定义网桥网络
    driver: bridge
services:
   mysql:
     image: mysql:8.0.32
     container_name: dream-mysql
     command:
       - --default-authentication-plugin=mysql_native_password
       - --character-set-server=utf8mb4
       - --collation-server=utf8mb4_unicode_ci
     restart: always
     environment:
       TZ: Asia/Shanghai
       MYSQL_ROOT_PASSWORD: mingqiyi
       MYSQL_DATABASE: dream_db
       MYSQL_USER: mmko
       MYSQL_PASSWORD: 123456
     ports:
       - "33307:3306"  # 对外暴露端口，供外部工具访问
     volumes:
       - mysql-data:/var/lib/d_mysql
       - ./sql:/docker-entrypoint-initdb.d
     networks:
       - app-network
     healthcheck:
       test: [ "CMD", "mysqladmin" ,"ping", "-h", "localhost" ]
       interval: 5s
       timeout: 10s
       retries: 10
       start_period: 15s
   phpmyadmin:
     image: phpmyadmin:5.2.1
     container_name: d_phpmyadmin
     hostname: phpmyadmin
     ports:
       - 8898:80
     environment:
       - PMA_HOST=mysql
       - PMA_PORT=3306
       - MYSQL_ROOT_PASSWORD=mingqiyi
     depends_on:
       mysql:
         condition: service_healthy
     networks:
       - app-network
# 数据卷定义
volumes:
  mysql-data: